<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><meta name="google-site-verification" content="bzZtQTbSAJGrkq97ZYmZLMazo8HfoVPpqj8aDEPrObA"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"sourcelizi.github.io",root:"/",scheme:"Pisces",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"post",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="本文与 0xFFFF论坛：记录下折腾香橙派过程中踩过的坑 同步  开始使用几个月之前入手了一块Orange PI One Plus开发板，实际用途是想拿来做个机顶盒（玩的） 本文虽然主要讨论的是One Plus，但很多软件操作同样适用于Orange PI 3 简单说一下硬件资源，这块开发板CPU是全志H6，带4K硬件解码，开发板本身带HDMI，红外，麦克风以及一个千兆网口，详细资料看这里。 其实"><meta property="og:type" content="article"><meta property="og:title" content="记录下折腾香橙派过程中踩过的坑"><meta property="og:url" content="https://sourcelizi.github.io/202001/play-with-orange-pi-one-plus/index.html"><meta property="og:site_name" content="搬砖笔记"><meta property="og:description" content="本文与 0xFFFF论坛：记录下折腾香橙派过程中踩过的坑 同步  开始使用几个月之前入手了一块Orange PI One Plus开发板，实际用途是想拿来做个机顶盒（玩的） 本文虽然主要讨论的是One Plus，但很多软件操作同样适用于Orange PI 3 简单说一下硬件资源，这块开发板CPU是全志H6，带4K硬件解码，开发板本身带HDMI，红外，麦克风以及一个千兆网口，详细资料看这里。 其实"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/serial.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/slow_download.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/fast_download.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/sys_info.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/armbian.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/compile.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/build.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/menuconfig.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/boot.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/Android_drivers.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/video_driver.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/config_file.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/kernel_files.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/busybox_config.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/udhcpc.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/out.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/find_libs.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/mkfs_err_fix.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/make_images.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/flash_image.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/remote_login.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/qt_mirror_down_load.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/qt_dbg_err.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/qt_config_ok.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/qt_ssh_deploy.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/qt_cross_compile.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/qt_cmake.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/qt_gdb_err.png"><meta property="og:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/allwinner_api.png"><meta property="article:published_time" content="2020-01-26T13:28:09.000Z"><meta property="article:modified_time" content="2020-08-22T06:42:34.000Z"><meta property="article:author" content="SourceLizi"><meta property="article:tag" content="Linux"><meta property="article:tag" content="Busybox"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://sourcelizi.github.io/images/play-with-orange-pi-one-plus/serial.png"><link rel="canonical" href="https://sourcelizi.github.io/202001/play-with-orange-pi-one-plus/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"zh-CN"}</script><title>记录下折腾香橙派过程中踩过的坑 | 搬砖笔记</title><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?9c258aa589420c0e156b993f11f38971";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="切换导航栏"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">搬砖笔记</h1><span class="logo-line-after"><i></i></span></a><p class="site-subtitle" itemprop="description">SourceLizi's Blog</p></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-guestbook"><a href="/guestbook/" rel="section"><i class="fa fa-comment fa-fw"></i>留言板</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="https://sourcelizi.github.io/202001/play-with-orange-pi-one-plus/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.png"><meta itemprop="name" content="SourceLizi"><meta itemprop="description" content="SourceLizi's Blog"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="搬砖笔记"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">记录下折腾香橙派过程中踩过的坑</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar"></i> </span><span class="post-meta-item-text">发表于</span> <time title="创建时间：2020-01-26 21:28:09" itemprop="dateCreated datePublished" datetime="2020-01-26T21:28:09+08:00">2020-01-26</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-calendar-check"></i> </span><span class="post-meta-item-text">更新于</span> <time title="修改时间：2020-08-22 14:42:34" itemprop="dateModified" datetime="2020-08-22T14:42:34+08:00">2020-08-22</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="far fa-folder"></i> </span><span class="post-meta-item-text">分类于</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Embedded/" itemprop="url" rel="index"><span itemprop="name">Embedded</span></a></span></span></div></header><div class="post-body" itemprop="articleBody"><blockquote><p>本文与 <a target="_blank" rel="noopener" href="https://0xffff.one/d/475">0xFFFF论坛：记录下折腾香橙派过程中踩过的坑</a> 同步</p></blockquote><h2 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h2><p>几个月之前入手了一块Orange PI One Plus开发板，实际用途是想拿来做个机顶盒<del>（玩的）</del></p><p>本文虽然主要讨论的是One Plus，但很多软件操作同样适用于Orange PI 3</p><p>简单说一下硬件资源，这块开发板CPU是全志H6，带4K硬件解码，开发板本身带HDMI，红外，麦克风以及一个千兆网口，详细资料看这里。 其实如果把这块开发板的硬件与树莓派3甚至4比，它的优势是很明显的，毕竟4K硬件解码也是到了4才有，但是软件开发支持不怎么友好。</p><h3 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h3><p>下面来讲讲上手的过程。首先你最好有已经装好了一个Ubuntu，版本16或者18都可以，主要用途是拿来编译。另外你还需要一条串口调试线，用来连接开发板上的硬件调试口，好处是在没有连接屏幕和键盘等外围设备的情况下你也能够调试开发板，上某宝买来大概是这个样子</p><p><img src="/images/play-with-orange-pi-one-plus/serial.png" alt="serial.png"></p><p>至于后面的如何接线、驱动和配置调试详细内容看手册，Linux系统和Windows下都可以用Putty调试，注意Putty在Ubuntu需要在终端sudo下才能打开。</p><p>另外由于One Plus没有eMMC，所以烧录和启动的话要用一张sd卡，也要提前准备好卡和读卡器</p><h3 id="烧写系统"><a href="#烧写系统" class="headerlink" title="烧写系统"></a>烧写系统</h3><p>现成镜像有Android TV 9，Debian，Ubuntu Server，好像最近Armbian测试通过了也放了上去。这一步按照手册来也没有太多坑。Android镜像似乎一定要用Windows下的工具烧录，另外除了两个Server版和Armbian外其他的都有图形界面。还有最近出的Armbian下载官网体验似乎一直不好，下载链接打开要么超时要么像这样</p><p><img src="/images/play-with-orange-pi-one-plus/slow_download.png" alt="slow_download.png"></p><p>正确打开方式：找国内镜像站，比如<a target="_blank" rel="noopener" href="https://mirrors.tuna.tsinghua.edu.cn/armbian-releases/orangepioneplus/archive/">清华的镜像</a>或者中科大的镜像，图为清华镜像下载</p><p><img src="/images/play-with-orange-pi-one-plus/fast_download.png" alt="fast_download.png"></p><p>在我们校内好像还有教育网加持，速度应该非常可观。其实不论是开发板的Armbian还是主机Ubuntu都应该更换国内镜像，在接下来的安装过程避免浪费时间，避免掉大坑里。下载完之后在Windows上可用工具中给的Win32DiskManager写入。先接好串口线，再把卡插入板上打开电源，你应该看到主机这一端有输出信息</p><p><img src="/images/play-with-orange-pi-one-plus/sys_info.png" alt="sys_info.png"><br><img src="/images/play-with-orange-pi-one-plus/armbian.png" alt="armbian.png"></p><p>现在应该就可以用串口终端玩耍Linux了</p><h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>官方给出了一个<a target="_blank" rel="noopener" href="https://github.com/orangepi-xunlong/OrangePi_Build">自动化脚本</a>，包括搭建交叉编译环境和Kernel与Uboot编译，手册里讲了如何一键编译Linux</p><p><img src="/images/play-with-orange-pi-one-plus/compile.png" alt="compile.png"></p><p>据说它的4.9还是测试版拿过来改的，所以我不太敢用4.9，这里我只编译了3.10。这个内核是可以给Android用的，具体例子看CSDN： <a target="_blank" rel="noopener" href="https://blog.csdn.net/whb_fei/article/details/78274570">H6机顶盒Android编译1-linux内核编译</a>，<a target="_blank" rel="noopener" href="https://blog.csdn.net/whb_fei/article/details/78318952">H6机顶盒Android编译2-Android编译</a>，使用的源码在<a target="_blank" rel="noopener" href="http://dl.linux-sunxi.org/H6/">这里</a></p><p>按照手册和自动化脚本做，这个过程没有遇到什么坑，当然接下来应该可以编译发行版。</p><p><img src="/images/play-with-orange-pi-one-plus/build.png" alt="build.png"></p><p>但是和Android一样，编译这种系统是个费时费力，而且什么也没有学到，所以我选了定制一个小型的系统</p><h2 id="定制"><a href="#定制" class="headerlink" title="定制"></a>定制</h2><p>所谓定制，就是在原有系统的基础上删减和增加自己的模块。本来编译前需要修改配置文件，但是上面给出的源码里面就已经预先配置好了，编译脚本只需要指定平台和交叉编译工具即可。实际上Linux Kernel编译系统本身就带了一个图形化的菜单可供配置。在刚才编译前下载的文件夹OrangePIH6中进入kernel文件夹，执行</p><p><code>make ARCH=arm64 menuconfig</code></p><p>ARCH指定了编译目标平台为arm64，后面应该出现一个这样的界面</p><p><img src="/images/play-with-orange-pi-one-plus/menuconfig.png" alt="menuconfig"></p><p>在这个菜单里空格可选中&#x2F;不选，回车进入菜单项，斜杠可以搜索。以下是我修改的选项：</p><ul><li>Boot Options的参数指定文件系统为ext4，不然后面可能出现挂载错误</li></ul><p><img src="/images/play-with-orange-pi-one-plus/boot.png" alt="boot.png"></p><ul><li>由于这个内核不是给Android用的，所以应该可以把Android的驱动全部删掉。但是好像有几个是硬件解码驱动要用的，删掉会编译失败，所以还是要选（当然如果不用解码驱动的话也可以全部删掉）</li></ul><p><img src="/images/play-with-orange-pi-one-plus/Android_drivers.png" alt="Android_drivers.png"></p><ul><li>视频解码驱动的话默认应该是有的，后面有勾了一个V4L的API，之后再试一下能不能用</li></ul><p><img src="/images/play-with-orange-pi-one-plus/video_driver.png" alt="video_driver.png"></p><p>然后其他设置不动，保存配置，编译的时候没有指定的话默认是用.config</p><p><img src="/images/play-with-orange-pi-one-plus/config_file.png" alt="config_file.png"></p><p>开上面脚本那个脚本编译一遍，完成后会提示你已经输出到output文件夹里了。交叉工具链在编译一步的脚本应该已经自动装好了，如果报错，请先检查以下你的<code>make</code> <code>build-essential</code> <code>gcc-aarch64-linux-gnu</code>等工具有没有装齐。然而现在仅仅是完成了内核编译，这些文件还带不起一个系统。</p><p><img src="/images/play-with-orange-pi-one-plus/kernel_files.png" alt="kernel_files.png"></p><hr><p>这时还需要制作一个根目录文件系统。对于OrangePI这样的小型开发板，一个轻量级的<a target="_blank" rel="noopener" href="https://busybox.net/">busybox</a>是最适合不过了。上网找了一下，确实有人做过类似的操作：<a target="_blank" rel="noopener" href="https://blog.csdn.net/kbitosy/article/details/89741365">Orangepi PC2 使用busybox制作文件系统</a>。按照教程，下载来跟刚才类似，开始配置编译</p><p><code>make menuconfig CROSS_COMPILE=aarch64-linux-gnu-</code></p><p>不过我与他不同的地方是我用了动态编译，因为之前用静态编译时到了后面就会增加不少麻烦。动态编译唯一的坏处是编译完成之后要把编译出来的文件所需要的二进制库复制进 &#x2F;lib ,不过实际上最终要复制的库也只有两个，ld和libc</p><p><img src="/images/play-with-orange-pi-one-plus/busybox_config.png" alt="busybox_config.png"></p><p>本来到了编译busybox这一步可以配置的东西很多，但基本上都是因人而异，玩法不一样预先要编译的也就不一样 ：）</p><p>这里唯一的坑在于一定要把uhcpc和ifconfig选上，不然就会面临接上了网线却没办法自动拿到ip的问题</p><p><img src="/images/play-with-orange-pi-one-plus/udhcpc.png" alt="udhcpc.png"></p><p>然后 <code>make &amp;&amp; make install</code>就完事了，输出文件默认在busybox目录下的_install文件夹里</p><p><img src="/images/play-with-orange-pi-one-plus/out.png" alt="out.png"></p><p>不得不说它编译的十分纯粹，只有干干净净的二进制文件，剩下的折腾过程就在于怎么写配置文件和写入。按照<a target="_blank" rel="noopener" href="https://blog.csdn.net/kbitosy/article/details/89741365">上面那篇教程</a>，</p><p>要建好 dev proc sys tmp mnt var&#x2F;log var&#x2F;lock var&#x2F;lib var&#x2F;run etc&#x2F;init.d几个文件夹，写rcS，profile和inittab。个人建议加上passwd，写上这样一行</p><blockquote><p>root::0:0:root:&#x2F;root:&#x2F;bin&#x2F;sh</p></blockquote><p>记得加好权限，并且建一个&#x2F;root文件夹，这样可以避免后面出现许多怪异的问题</p><p>然后把busybox&#x2F;example&#x2F;uhdcp&#x2F;simple.script复制进刚刚生成的&#x2F;usr&#x2F;share&#x2F;udhcpc下，并且改名为default.script，以便udhcpc后面自动获取ip</p><p>至于动态链接库的问题，用<code>aarch64-linux-gnu-readelf -d</code>可以读出二进制文件需要什么库，可以cd到busybox根目录下的bin文件夹里用<code>aarch64-linux-gnu-readelf -d ./* | grep NEEDED</code>看看各个文件用了什么库，如果重复多，可以<code>aarch64-linux-gnu-readelf -d ./* | grep NEEDED | sort | uniq</code>自动去重，最后只有</p><p><img src="/images/play-with-orange-pi-one-plus/find_libs.png" alt="find_libs"></p><p>如果你是用apt安装的工具链的话，其链接库文件应该在你的主机&#x2F;usr&#x2F;aarch64-linux-gnu&#x2F;lib下, 把这些库文件及其链接复制到&#x2F;lib下即可</p><p>每次这样操作确实十分繁琐，你可以写一个脚本完成，也可以像我现在这样建一个空目录，当作根目录按上面操作一次，再把这个目录与_install文件夹生成文件合并一次</p><h2 id="生成镜像"><a href="#生成镜像" class="headerlink" title="生成镜像"></a>生成镜像</h2><p>其实技术上没有什么难度，把官方给的&#x2F;script&#x2F;build_image.sh改一下即可：</p><ul><li><p>把脚本里的rootfs路径ROOTFS改成busybox的，配置好常量如镜像名</p></li><li><p>分区设定的参数里可以把boot_size和disk_size改小，boot_size大概30M左右就够了，disk_size是boot_size+你的roofs大小，busybox的根目录大概只有3~5M</p></li><li><p>mkfs.ext4那行要加参数<code>-O ^64bit,^metadata_csum</code>，不然开机之后会报挂载失败的错</p><p><img src="/images/play-with-orange-pi-one-plus/mkfs_err_fix.png" alt="mkfs_err_fix"></p></li><li><p>由于这个脚本是要sudo运行的，所以后面要把images文件夹chown -R 改归当前用户</p></li></ul><p>来一波sudo .&#x2F;build_image.sh即可得到我们想要的镜像文件</p><p><img src="/images/play-with-orange-pi-one-plus/make_images.png" alt="make_images"></p><p>再用balenaEtcher烧写进sd卡，启动！</p><p><img src="/images/play-with-orange-pi-one-plus/flash_image.png" alt="flash_image"></p><p>4秒开机感觉相当不错～～ 虽然没有扩容，但是文件系统大小也是够用的。不过代价就是busybox上面没有我们熟悉的一切服务，连个网要手动udhcpc（当然写进rcS也不是不行）</p><p>接下来我想在上面加个ssh客户端和上传文件服务器，整个完整的开发环境，明天再来</p><h2 id="SSH客户端与文件服务器"><a href="#SSH客户端与文件服务器" class="headerlink" title="SSH客户端与文件服务器"></a>SSH客户端与文件服务器</h2><p>本来这两个东西可以直接装个OpenSSH解决，不过OpenSSH又要zlib和OpenSSL的库，然后OpenSSL又要牵扯一大堆的库。这些库要一一编译一次，其中不少是没有对交叉编译做适配的，所以比较烦。最后找到了一个简单的SSH客户端<a target="_blank" rel="noopener" href="http://matt.ucc.asn.au/dropbear/dropbear.html">DropBear</a>，编译可以不用除了libc外的任何库</p><p>在下载来的源码目录执行以下命令即可完成交叉编译</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --host=aarch64-linux-gnu --prefix=/ --disable-zlib CC=aarch64-linux-gnu-gcc LD=aarch64-linux-gnu-ld</span><br><span class="line">make &amp;&amp; make install DESTDIR=./output</span><br></pre></td></tr></table></figure><p>其中输出文件夹output要预先建好，把输出文件夹下的文件复制到busybox的根目录下即可</p><p>有一点比较坑的是虽然它本身编译时只链接了libc，但是实际上还有libnss_file.so要复制过去，不然就会因为读不到用户信息而报错，具体看这里：<a target="_blank" rel="noopener" href="https://blog.csdn.net/hbcbgcx/article/details/88351325">解决dropbear在busybox中使用无法使用本地用户登录问题</a></p><p>接下来就是在开发板上配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /etc/dropbear</span><br><span class="line">dropbearkey -t rsa -f /etc/dropbear/dropbear_rsa_hostkey</span><br><span class="line">dropbearkey -t dss -f /etc/dropbear/dropbear_dss_hostkey</span><br><span class="line">dropbearkey -t edcsa -f /etc/dropbear/dropbear_edcsa_hostkey</span><br></pre></td></tr></table></figure><p>当然现在可以配置私钥登陆，把生成的私钥文件复制到&#x2F;root&#x2F;.ssh&#x2F;下并改名为authorized_keys，不过搭好文件服务器后就可以用更简单的办法上传。现在先用<code>passwd</code> 改一下密码，然后连上局域网之后就可以直接登陆了</p><p><img src="/images/play-with-orange-pi-one-plus/remote_login.png" alt="remote_login"></p><p>文件服务器一开始是想用ftpd之类的。后来是搭好了，准备开始弄开发环境才发现有问题。之前一直在找一个能远程部署并且远程调试，能媲美本地开发的工具，也找到一个<a target="_blank" rel="noopener" href="https://www.qt.io/">QTCreator</a>。当时在学校下载，官网很慢，老办法用镜像站</p><p><img src="/images/play-with-orange-pi-one-plus/qt_mirror_down_load.png" alt="qt_mirror_down_load"></p><p>有没有感觉校园网突然香起来了哈哈哈</p><p>然后按照这个<a target="_blank" rel="noopener" href="https://blog.csdn.net/u014213012/article/details/76850663">配置教程</a>配好之后发现好像还少了一个sftp，网友提示要编译一次OpenSSH，那我的DropBear有什么用？？？不过最后还是卡在编译OpenSSL上，没有办法。不过QTCreator每次验证我的选项之后都会说少sftp和rsync</p><p><img src="/images/play-with-orange-pi-one-plus/qt_dbg_err.png" alt="qt_dbg_err"></p><p>难道两个都要？后来上网查了一下rsync是什么，发现也是用来传输文件的，试着编译一遍，发现很快搞定，也不需要什么库</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./configure --prefix=<span class="variable">$PWD</span>/output --host=aarch64-linux-gnu --with-rsh=dropbear --with-included-popt --with-included-zlib</span><br><span class="line">make &amp;&amp; make install</span><br></pre></td></tr></table></figure><p>丢到&#x2F;bin里面，在用QTCreator试一下，OK！</p><p><img src="/images/play-with-orange-pi-one-plus/qt_config_ok.png" alt="qt_config_ok"></p><p>这就是我刚才说支持一键部署SSH密钥的地方，美滋滋～～</p><p><img src="/images/play-with-orange-pi-one-plus/qt_ssh_deploy.png" alt="qt_ssh_deploy"></p><p>在Kits里面配置交叉编译器一下应该就可以线上调试了</p><p><img src="/images/play-with-orange-pi-one-plus/qt_cross_compile.png" alt="qt_cross_compile"></p><p>建立个cmake的项目试试启动调试</p><p><img src="/images/play-with-orange-pi-one-plus/qt_cmake.png" alt="qt_cmake"></p><p>本来之前编译了个gdbserver放上去，结果还不行？一开始我以为<code>:10000</code>这个参数是乱给的，后来发现其实它的意思是在本地10000端口打开gdbserver，但是前面的ip省略了。但是前面加个*号就可以，然后我在QTCreator里还找不到调整gdb参数设置的地方？</p><p><img src="/images/play-with-orange-pi-one-plus/qt_gdb_err.png" alt="qt_gdb_err"></p><p>结果就是这个问题现在无解，更加棘手的是QTCreator好像还没把我编译好的文件上传上去，按照<a target="_blank" rel="noopener" href="https://doc.qt.io/qtcreator/creator-deployment-embedded-linux.html">官方</a>的说法要自己配置上传，所以白折腾一场？？？</p><h2 id="硬件编解码驱动与其他"><a href="#硬件编解码驱动与其他" class="headerlink" title="硬件编解码驱动与其他"></a>硬件编解码驱动与其他</h2><p>之前远程调试的问题其实在armbian或者ubuntu下就完全没有问题，毕竟开发用这两个系统才合适</p><p>另外关于硬件解码的驱动还是有办法解决的，在官方提供的Android驱动下有民间整合的硬件解码驱动，所以只要用一般的视频播放接口即可实现，可惜不是底层的驱动。不过官方也放出了各种芯片平台通用的linux<a target="_blank" rel="noopener" href="https://github.com/allwinner-zh/media-codec">驱动</a>，并且比较让人高兴的是终于带上了文档。</p><p><img src="/images/play-with-orange-pi-one-plus/allwinner_api.png" alt="allwinner_api"></p><p>编译驱动的过程可能会出错，按这篇教程来<a target="_blank" rel="noopener" href="https://blog.csdn.net/takeopen/article/details/79490010">全志 CedarX 库linux安装</a>（不得不吐槽一下这个居然不能编译成arm64，浪费了H6这样的架构）。不过静态编译会让编解码库找不到插件路径报错（不影响使用），改一下GetLocalPathFromProcessMaps或者AddVEncPlugin&#x2F;AddVDPlugin即可</p><p>还有一个看上去比较靠谱的<a target="_blank" rel="noopener" href="https://github.com/FREEWING-JP/OrangePi_CedarX">源码</a>，连播放器demo都带上了。但是目前在我本机上编译失败，原因似乎是本机少了arm上的alsa库，而且大概因为这些库在busybox上移植也比较麻烦<del>（毕竟别人的目标平台还是ubuntu）</del>。</p><p>在Github上找找还是有不少好东西的，比如说别人针对开发板制作的<a target="_blank" rel="noopener" href="https://github.com/avafinger/orangepi-h6-ubuntu-base-minimal">ubuntu精简版</a>。剩下的代码不是没有文档的就是处于实验性质的，姑且当作参考</p><ul><li><a target="_blank" rel="noopener" href="https://github.com/ugers/android_external_cedarx">https://github.com/ugers/android_external_cedarx</a></li><li><a target="_blank" rel="noopener" href="https://github.com/allwinner-dev-team/android_external_cedarx">https://github.com/allwinner-dev-team/android_external_cedarx</a></li><li><a target="_blank" rel="noopener" href="https://github.com/FREEWING-JP/OrangePi_CedarX">https://github.com/FREEWING-JP/OrangePi_CedarX</a></li><li><a target="_blank" rel="noopener" href="https://github.com/Allwinner-Homlet/H6-CedarC">https://github.com/Allwinner-Homlet/H6-CedarC</a></li><li><a target="_blank" rel="noopener" href="https://github.com/linux-sunxi/cedarx-libs">https://github.com/linux-sunxi/cedarx-libs</a></li><li><a target="_blank" rel="noopener" href="https://github.com/liqil/cedarx-libs">https://github.com/liqil/cedarx-libs</a></li><li><a target="_blank" rel="noopener" href="https://github.com/linux-sunxi/libcedrus">https://github.com/linux-sunxi/libcedrus</a></li><li><a target="_blank" rel="noopener" href="https://github.com/bootlin/libva-v4l2-request">https://github.com/bootlin/libva-v4l2-request</a></li><li><a target="_blank" rel="noopener" href="https://github.com/linux-sunxi/libvdpau-sunxi">https://github.com/linux-sunxi/libvdpau-sunxi</a></li><li><a target="_blank" rel="noopener" href="https://github.com/allwinner-zh/media-codec">https://github.com/allwinner-zh/media-codec</a></li><li><a target="_blank" rel="noopener" href="https://github.com/allwinner-zh/media-codec-lib">https://github.com/allwinner-zh/media-codec-lib</a></li><li><a target="_blank" rel="noopener" href="https://github.com/avafinger/v4l2-request-test">https://github.com/avafinger/v4l2-request-test</a></li><li><a target="_blank" rel="noopener" href="https://github.com/bootlin/v4l2-request-test">https://github.com/bootlin/v4l2-request-test</a></li><li><a target="_blank" rel="noopener" href="https://github.com/fsebentley/CedarX-12.06.2015">https://github.com/fsebentley/CedarX-12.06.2015</a></li><li><a target="_blank" rel="noopener" href="https://github.com/leviathanch/sunxi-cedarx-blobs">https://github.com/leviathanch/sunxi-cedarx-blobs</a></li><li><a target="_blank" rel="noopener" href="https://github.com/noblock/sunxi-cedar-mainline">https://github.com/noblock/sunxi-cedar-mainline</a></li></ul><p>busybox下面还有一个问题就是即使CPU占有为0%，芯片的温度依然高居不下。目前的解决方案是修改cpu的调度器</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> ondemand &gt; /sys/devices/system/cpu/cpu0/cpufreq/scaling_governor</span><br><span class="line"><span class="built_in">echo</span> ondemand &gt; /sys/devices/system/cpu/cpu1/cpufreq/scaling_governor</span><br><span class="line"><span class="built_in">echo</span> ondemand &gt; /sys/devices/system/cpu/cpu2/cpufreq/scaling_governor</span><br><span class="line"><span class="built_in">echo</span> ondemand &gt; /sys/devices/system/cpu/cpu3/cpufreq/scaling_governor</span><br></pre></td></tr></table></figure><p>其中可用的调度器可以通过<code>cat /sys/devices/system/cpu/cpu0/cpufreq/scaling_available_governors</code>查到，有一下几种</p><p>performance: 最大性能 powersave: 最高节能 ondemand: 快升快降 interactive: 快升慢降 conservative: 慢升快降</p><p>buxybox默认用的performance的策略就是始终让CPU处于最高频率1.8Ghz，所以温度才会一直拉满。</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/Linux/" rel="tag"><i class="fa fa-tag"></i> Linux</a> <a href="/tags/Busybox/" rel="tag"><i class="fa fa-tag"></i> Busybox</a></div><div class="post-nav"><div class="post-nav-item"><a href="/202001/matlab-sys-identfiy-pid/" rel="prev" title="Matlab辅助PID调参"><i class="fa fa-chevron-left"></i> Matlab辅助PID调参</a></div><div class="post-nav-item"><a href="/202002/pwn-rop-note/" rel="next" title="CTF - PWN ROP记录">CTF - PWN ROP记录 <i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script src="https://utteranc.es/client.js" repo="SourceLizi/sourcelizi.github.io" issue-term="pathname" label="utterances" theme="github-light" crossorigin="anonymous" async></script><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span> <span class="toggle-line toggle-line-middle"></span> <span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">文章目录</li><li class="sidebar-nav-overview">站点概览</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E4%BD%BF%E7%94%A8"><span class="nav-number">1.</span> <span class="nav-text">开始使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87"><span class="nav-number">1.1.</span> <span class="nav-text">准备</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%83%A7%E5%86%99%E7%B3%BB%E7%BB%9F"><span class="nav-number">1.2.</span> <span class="nav-text">烧写系统</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BC%96%E8%AF%91"><span class="nav-number">2.</span> <span class="nav-text">编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E5%88%B6"><span class="nav-number">3.</span> <span class="nav-text">定制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%9F%E6%88%90%E9%95%9C%E5%83%8F"><span class="nav-number">4.</span> <span class="nav-text">生成镜像</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSH%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%B8%8E%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="nav-number">5.</span> <span class="nav-text">SSH客户端与文件服务器</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A1%AC%E4%BB%B6%E7%BC%96%E8%A7%A3%E7%A0%81%E9%A9%B1%E5%8A%A8%E4%B8%8E%E5%85%B6%E4%BB%96"><span class="nav-number">6.</span> <span class="nav-text">硬件编解码驱动与其他</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="SourceLizi" src="/images/avatar.png"><p class="site-author-name" itemprop="name">SourceLizi</p><div class="site-description" itemprop="description">SourceLizi's Blog</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">41</span> <span class="site-state-item-name">日志</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">6</span> <span class="site-state-item-name">分类</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">21</span> <span class="site-state-item-name">标签</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/SourceLizi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;SourceLizi" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a> </span><span class="links-of-author-item"><a href="mailto:lizi_bussiness@outlook.com" title="E-Mail → mailto:lizi_bussiness@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2019 – <span itemprop="copyrightYear">2023</span> <span class="with-love"><i></i> </span><span class="author" itemprop="copyrightHolder">SourceLizi</span></div><div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> 驱动</div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script src="/js/local-search.js"></script></body></html>